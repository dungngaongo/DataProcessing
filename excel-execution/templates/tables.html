<div class="sheet-container">
    <div id="sizing-sheet" class="sheet active">
        <table class="excel-table">
            <thead>
                <tr>
                {% for col in sizing_columns %}
                    <th class="col-header-cell">
                        <span contenteditable="true"
                            class="col-header-name"
                            data-sheet="Sizing"
                            data-col-index="{{ loop.index0 }}"
                            data-old-col-name="{{ col }}">
                            {{ col }}
                        </span>
                        <div class="col-controls">
                            <button type="button"
                                    title="Thêm cột bên trái"
                                    hx-prompt="Nhập tên cột mới (ví dụ: 'Cột mới'):"
                                    hx-vals='{"new_col_name": "${prompt}"}'
                                    hx-post="/handle-col/Sizing/insert/{{ loop.index0 }}"
                                    hx-target="#tables-container"
                                    hx-swap="innerHTML">↤+</button>
                            {% if col != 'STT' %}
                            <button type="button"
                                    title="Xóa cột này"
                                    hx-confirm="Bạn có chắc muốn xóa cột {{ col }}?"
                                    hx-post="/handle-col/Sizing/delete/{{ loop.index0 }}"
                                    hx-target="#tables-container"
                                    hx-swap="innerHTML">×</button>
                            {% endif %}
                        </div>
                    </th>
                {% endfor %}
                </tr>
            </thead>
            <tbody>
            {% if sizing_rows and sizing_rows|length > 0 %}
                {% for row in sizing_rows %}
                    <tr class="data-row" data-row="{{ loop.index0 }}">
                        {% for col in sizing_columns %}
                            {% if col == 'Tên dự án - Mục đích sizing' %}
                            <td contenteditable="true" class="cell project-link" data-project="{{ row[col]|blanknan }}" data-sheet="Sizing" data-row="{{ loop.index0 }}" data-col="{{ col }}">{{ row[col]|blanknan }}</td>
                            {% else %}
                            <td contenteditable="true" class="cell" data-sheet="Sizing" data-row="{{ loop.index0 }}" data-col="{{ col }}">{{ row[col]|blanknan }}</td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr class="add-row-trigger" data-after="{{ loop.index0 }}">
                        <td colspan="{{ sizing_columns|length }}" class="add-row-cell">
                            <button type="button" class="add-row-btn" hx-post="/add-row/Sizing/{{ loop.index0 }}" hx-target="#sizing-sheet" hx-swap="outerHTML">+</button>
                            <button type="button" class="delete-row-btn" hx-post="/delete-row/Sizing/{{ loop.index0 }}" hx-target="#sizing-sheet" hx-swap="outerHTML">×</button>
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="{{ sizing_columns|length }}" class="empty">(Chưa có dữ liệu)</td></tr>
                <tr class="add-row-trigger always-show" data-after="-1">
                    <td colspan="{{ sizing_columns|length }}" class="add-row-cell">
                        <button type="button" class="add-row-btn" hx-post="/add-row/Sizing/-1" hx-target="#sizing-sheet" hx-swap="outerHTML">+</button>
                    </td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
    <div id="cap-phat-sheet" class="sheet">
        <table class="excel-table">
            <thead>
                <tr>
                {% for col in cap_phat_columns %}
                    <th class="col-header-cell">
                        <span contenteditable="true"
                            class="col-header-name"
                            data-sheet="CapPhat"
                            data-col-index="{{ loop.index0 }}"
                            data-old-col-name="{{ col }}">
                            {{ col }}
                        </span>
                        <div class="col-controls">
                            <button type="button"
                                    title="Thêm cột bên trái"
                                    hx-prompt="Nhập tên cột mới (ví dụ: 'Cột mới'):"
                                    hx-vals='{"new_col_name": "${prompt}"}'
                                    hx-post="/handle-col/CapPhat/insert/{{ loop.index0 }}"
                                    hx-target="#tables-container"
                                    hx-swap="innerHTML">↤+</button>
                            {% if col != 'STT' %}
                            <button type="button"
                                    title="Xóa cột này"
                                    hx-confirm="Bạn có chắc muốn xóa cột {{ col }}?"
                                    hx-post="/handle-col/CapPhat/delete/{{ loop.index0 }}"
                                    hx-target="#tables-container"
                                    hx-swap="innerHTML">×</button>
                            {% endif %}
                        </div>
                    </th>
                {% endfor %}
                </tr>
            </thead>
            <tbody>
            {% if cap_phat_rows and cap_phat_rows|length > 0 %}
                {% for row in cap_phat_rows %}
                    <tr class="data-row" data-row="{{ loop.index0 }}">
                        {% for col in cap_phat_columns %}
                            {% if col == 'Dự án' %}
                            <td contenteditable="true" class="cell cap-project-link" data-sheet="CapPhat" data-row="{{ loop.index0 }}" data-col="{{ col }}" data-cap-project="{{ row[col]|blanknan }}">{{ row[col]|blanknan }}</td>
                            {% else %}
                            <td contenteditable="true" class="cell" data-sheet="CapPhat" data-row="{{ loop.index0 }}" data-col="{{ col }}">{{ row[col]|blanknan }}</td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr class="add-row-trigger" data-after="{{ loop.index0 }}">
                        <td colspan="{{ cap_phat_columns|length }}" class="add-row-cell">
                            <button type="button" class="add-row-btn" hx-post="/add-row/CapPhat/{{ loop.index0 }}" hx-target="#cap-phat-sheet" hx-swap="outerHTML">+</button>
                            <button type="button" class="delete-row-btn" hx-post="/delete-row/CapPhat/{{ loop.index0 }}" hx-target="#cap-phat-sheet" hx-swap="outerHTML">×</button>
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="{{ cap_phat_columns|length }}" class="empty">(Chưa có dữ liệu)</td></tr>
                <tr class="add-row-trigger always-show" data-after="-1">
                    <td colspan="{{ cap_phat_columns|length }}" class="add-row-cell">
                        <button type="button" class="add-row-btn" hx-post="/add-row/CapPhat/-1" hx-target="#cap-phat-sheet" hx-swap="outerHTML">+</button>
                    </td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
    <div id="chi-tiet-sheet" class="sheet">
        <table class="excel-table">
            <thead>
                <tr>
                {% for col in chi_tiet_columns %}
                    <th class="col-header-cell">
                        <span contenteditable="true"
                            class="col-header-name"
                            data-sheet="ChiTiet"
                            data-col-index="{{ loop.index0 }}"
                            data-old-col-name="{{ col }}">
                            {{ col }}
                        </span>
                        <div class="col-controls">
                            <button type="button"
                                    title="Thêm cột bên trái"
                                    hx-prompt="Nhập tên cột mới (ví dụ: 'Cột mới'):"
                                    hx-vals='{"new_col_name": "${prompt}"}'
                                    hx-post="/handle-col/ChiTiet/insert/{{ loop.index0 }}"
                                    hx-target="#tables-container"
                                    hx-swap="innerHTML">↤+</button>
                            {% if col != 'STT' %}
                            <button type="button"
                                    title="Xóa cột này"
                                    hx-confirm="Bạn có chắc muốn xóa cột {{ col }}?"
                                    hx-post="/handle-col/ChiTiet/delete/{{ loop.index0 }}"
                                    hx-target="#tables-container"
                                    hx-swap="innerHTML">×</button>
                            {% endif %}
                        </div>
                    </th>
                {% endfor %}
                </tr>
            </thead>
            <tbody>
            {% if chi_tiet_rows and chi_tiet_rows|length > 0 %}
                {% for row in chi_tiet_rows %}
                    <tr class="data-row" data-row="{{ loop.index0 }}">
                        {% for col in chi_tiet_columns %}
                            <td contenteditable="true" class="cell" data-sheet="ChiTiet" data-row="{{ loop.index0 }}" data-col="{{ col }}">{{ row[col]|blanknan }}</td>
                        {% endfor %}
                    </tr>
                    <tr class="add-row-trigger" data-after="{{ loop.index0 }}">
                        <td colspan="{{ chi_tiet_columns|length }}" class="add-row-cell">
                            <button type="button" class="add-row-btn" hx-post="/add-row/ChiTiet/{{ loop.index0 }}" hx-target="#chi-tiet-sheet" hx-swap="outerHTML">+</button>
                            <button type="button" class="delete-row-btn" hx-post="/delete-row/ChiTiet/{{ loop.index0 }}" hx-target="#chi-tiet-sheet" hx-swap="outerHTML">×</button>
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="{{ chi_tiet_columns|length }}" class="empty">(Chưa có dữ liệu)</td></tr>
                <tr class="add-row-trigger always-show" data-after="-1">
                    <td colspan="{{ chi_tiet_columns|length }}" class="add-row-cell">
                        <button type="button" class="add-row-btn" hx-post="/add-row/ChiTiet/-1" hx-target="#chi-tiet-sheet" hx-swap="outerHTML">+</button>
                    </td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
</div>
<script src="{{ url_for('static', filename='js/kpi.js') }}"></script>