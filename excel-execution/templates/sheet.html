{#
    Partial cho render một sheet đơn lẻ (tái sử dụng):
    - Dùng trong thêm/xoá dòng qua HTMX để cập nhật một sheet
    - Giữ cấu trúc bảng và các thuộc tính data-* cho JS
#}
<div id="{{ sheet_id }}" class="sheet active">
    <table class="excel-table">
        <thead>
            <tr>
            {% for col in columns %}
                <th>{{ col }}</th>
            {% endfor %}
            </tr>
        </thead>
        <tbody>
        {% if rows and rows|length > 0 %}
            {% for row in rows %}
            <tr class="data-row" data-row="{{ loop.index0 }}" data-row-id="{{ row['row_id'] }}">
                {% for col in columns %}
                <td contenteditable="true" class="cell" data-sheet="{{ sheet_name }}" data-row="{{ loop.index0 }}" data-row-id="{{ row['row_id'] }}" data-col="{{ col }}">{{ row[col]|blanknan }}</td>
                {% endfor %}
            </tr>
            <tr class="add-row-trigger" data-after="{{ loop.index0 }}">
                <td colspan="{{ columns|length }}" class="add-row-cell">
                    <button type="button" class="add-row-btn" hx-post="/add-row/{{ sheet_name }}/{{ loop.index0 }}" hx-target="#{{ sheet_id }}" hx-swap="outerHTML">+</button>
                    <button type="button" class="delete-row-btn" hx-post="/delete-row/{{ sheet_name }}/{{ loop.index0 }}" hx-target="#{{ sheet_id }}" hx-swap="outerHTML">×</button>
                </td>
            </tr>
            {% endfor %}
        {% else %}
            <tr><td colspan="{{ columns|length }}" class="empty">(Chưa có dữ liệu)</td></tr>
            <tr class="add-row-trigger always-show" data-after="-1">
                <td colspan="{{ columns|length }}" class="add-row-cell">
                    <button type="button" class="add-row-btn" hx-post="/add-row/{{ sheet_name }}/-1" hx-target="#{{ sheet_id }}" hx-swap="outerHTML">+</button>
                </td>
            </tr>
        {% endif %}
        </tbody>
    </table>
</div>